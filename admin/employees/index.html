<html>

<head>
    <title>UERM E-Triage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../../jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../font-awesome/css/font-awesome.min.css" />

    <script src="../../bootstrap/js/bootstrap.js"></script>
    <script src="../../vue/vue.js"></script>
    <script src="../../javascripts/md5.js"></script>

    <style>
        body,
        html {
            height: 100% !important;
        }

        .item.active {
            background-color: rgba(166, 220, 255, 0.5);
        }

        .item {
            cursor: pointer;
        }

        .text-color {
            color: white;
        }

        #vue-app {
            overflow: auto;
        }
    </style>
</head>

<body>
    <div id="vue-app" class="h-100">
        <header>
            <div class="navbar navbar-dark bg-primary shadow-sm">
                <div class="container d-flex justify-content-between">
                    <button type="button" v-if="currentPage != '/'" v-on:click="initValues"
                        class="btn btn-outline-light">
                        <i class="fa fa-arrow-left"></i>
                    </button>
                    <a href="#" class="navbar-brand d-flex align-items-center">
                        <strong>ETriage</strong>
                    </a>
                </div>
            </div>
        </header>

        <div v-if="!isDataLoaded" class="p-3 text-center">
            <div>Fetching Data</div>
            <div>
                <b class="fa fa-spinner fa-spin"></b>
            </div>
        </div>

        <div class="container py-5" v-if="isDataLoaded && currentPage == '/'">
            <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
                <h1 class="display-4">ETriage Dashboard</h1>
            </div>
            <div class="card-deck mb-12 text-center">
                <div class="card mb-3 shadow-sm">
                    <div class="card-header">
                        <h4 class="my-0 font-weight-normal">Employees Today</h4>
                    </div>
                    <div class="card-body">
                        <h1 class="card-title pricing-card-title">{{eTriageEmployeeCountToday}}</small></h1>
                        <button type="button" v-on:click="setPage('/eTriageToday')"
                            class="btn btn-lg btn-block btn-primary">Get Info</button>
                    </div>
                </div>
            </div>

            <div class="card-deck mb-12 text-center">
                <div class="card mb-4 shadow-sm" v-for="eTriageByGenderCount in eTriageByGenderCountToday">
                    <div class="card-header">
                        <h4 class="my-0 font-weight-normal">
                            <span v-if="eTriageByGenderCount['gender'] === null">
                                N/A
                            </span>
                            <span v-else-if="eTriageByGenderCount['gender'] === 'F'">
                                FEMALE
                            </span>
                            <span v-else-if="eTriageByGenderCount['gender'] === 'M'">
                                MALE
                            </span>
                        </h4>
                    </div>
                    <div class="card-body">
                        <h1 class="card-title pricing-card-title">{{eTriageByGenderCount['']}}</h1>

                        <button type="button" class="btn btn-lg btn-block btn-info">Get Info</button>
                    </div>
                </div>
            </div>


            <div class="card-deck mb-12 text-center">
                <div class="card mb-4 shadow-sm" v-for="eTriageByClassCount in eTriageByClassCountToday">
                    <div class="card-header">
                        <h4 class="my-0 font-weight-normal">
                            {{eTriageByClassCount['class']}}
                        </h4>
                    </div>
                    <div class="card-body">
                        <h1 class="card-title pricing-card-title">{{eTriageByClassCount['count']}}</h1>

                        <button type="button" class="btn btn-lg btn-block btn-warning">Get Info</button>
                    </div>
                </div>
            </div>


            <div class="card-deck mb-12 text-center">
                <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
                    <h2 class="display-4">Historical Data</h2>
                </div>
                <div style="height: 400px; overflow-y: auto;">
                    <table id="" class="table table-striped table-hover text-center">
                        <thead>
                            <tr>
                                <th scope="col">Code</th>
                                <th scope="col" width="20%">Name</th>
                                <th scope="col">Age</th>
                                <th scope="col">Gender</th>
                                <th scope="col">Position</th>
                                <th scope="col">Department</th>
                                <th scope="col">Class</th>
                                <th scope="col">Temperature</th>
                                <th scope="col">Symptoms and History</th>
                                <th scope="col">For ER</th>
                                <th scope="col">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="eTriageHistoricalResult in eTriageHistorical">
                                <td>{{eTriageHistoricalResult.code}}</td>
                                <td>{{eTriageHistoricalResult.name}}</td>
                                <td>{{eTriageHistoricalResult.age}}</td>
                                <td>{{eTriageHistoricalResult.gender}}</td>
                                <td>{{eTriageHistoricalResult.position}}</td>
                                <td>{{eTriageHistoricalResult.department}}</td>
                                <td>{{eTriageHistoricalResult.class}}</td>
                                <td>{{eTriageHistoricalResult.temperature}}</td>
                                <td v-html="eTriageHistoricalResult.symotomsAndHistory"></td>
                                <td>
                                    <span v-if="eTriageHistoricalResult['isForCovidEr'] === 0">
                                        N/A
                                    </span>
                                    <span v-else-if="eTriageHistoricalResult['isForCovidEr'] === 1">
                                        For ER
                                    </span>
                                </td>
                                <td>{{eTriageHistoricalResult.date}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="container" v-if="currentPage == '/eTriageToday'">
            <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
                <h1 class="display-4">ETriage Employees Today</h1>
            </div>
            <div class="card-deck mb-12 text-center">
                <div class="card mb-4 shadow-sm">
                    <div class="card-body">
                        <div style="height: 400px; overflow-y: auto;">
                            <table id="" class="table table-striped table-hover text-center">
                                <thead>
                                    <tr>
                                        <th scope="col" width="20%">Name</th>
                                        <th scope="col">Age</th>
                                        <th scope="col">Gender</th>
                                        <th scope="col">Position</th>
                                        <th scope="col">Department</th>
                                        <th scope="col">Class</th>
                                        <th scope="col">Temperature</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="eTriageDetailedTodayResult in eTriageDetailedToday">
                                        <td>{{eTriageDetailedTodayResult.name}}</td>
                                        <td>{{eTriageDetailedTodayResult.age}}</td>
                                        <td>{{eTriageDetailedTodayResult.gender}}</td>
                                        <td>{{eTriageDetailedTodayResult.position}}</td>
                                        <td>{{eTriageDetailedTodayResult.department}}</td>
                                        <td>{{eTriageDetailedTodayResult.class}}</td>
                                        <td>{{eTriageDetailedTodayResult.temperature}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const vue = new Vue({
            el: "#vue-app",
            data: {
                apiUrl: "https://apps.uerm.edu.ph:3443/",
                apiKey: "7190WHUt7gzKgrRURMnoS4D7tX6Xp112",
                eTriageEmployeeCountDetailedToday: '',
                eTriageEmployeeCountToday: '',
                eTriageByGenderDetailedToday: '',
                eTriageByGenderCountToday: '',
                eTriageByClassDetailedToday: '',
                eTriageByClassCountToday: '',
                eTriageDetailedToday: '',
                eTriageHistorical: '',
                currentPage: "/",
                isDataLoaded: false,
            },
            created() {
                this.eTriageCountToday();
                this.eTriageCountTodayByClass();
                this.eTriageCountTodayByGender();
                this.eTriageDetailedCountToday();
                this.eTriageHistoricalData();
            },
            methods: {
                setPage(route) {
                    this.currentPage = route;
                },
                initValues() {
                    this.currentPage = "/";
                },
                async eTriageHistoricalData() {
                    const response = await fetch(
                        `${this.apiUrl}etriage/dashboard?auth=${this.apiKey}`,
                        {
                            method: "GET",
                            headers: { "Content-Type": "application/json" },
                        }
                    );
                    const responseJson = await response.json();

                    for (result of responseJson) {
                        if (result.symotomsAndHistory != null) {
                            let symptoms = result.symotomsAndHistory.replace(/[_]/g, ' ').toUpperCase().split(';').join('</div><div>');
                            result.symotomsAndHistory = `<div>${symptoms}</div>`;
                        } else {
                            result.symotomsAndHistory = 'N/A';
                        }
                    }

                    if (responseJson.length > 0) {
                        this.showStatus = true;
                    }
                    this.isDataLoaded = true,
                        this.eTriageHistorical = responseJson;
                },
                async eTriageDetailedCountToday() {
                    const response = await fetch(
                        `${this.apiUrl}etriage/dashboard-etriage-today?auth=${this.apiKey}`,
                        {
                            method: "GET",
                            headers: { "Content-Type": "application/json" },
                        }
                    );
                    const responseJson = await response.json();

                    if (responseJson.length > 0) {
                        this.showStatus = true;
                    }

                    this.eTriageDetailedToday = responseJson;
                },
                async eTriageCountToday() {
                    const response = await fetch(
                        `${this.apiUrl}etriage/dashboard-etriage-today?auth=${this.apiKey}`,
                        {
                            method: "GET",
                            headers: { "Content-Type": "application/json" },
                        }
                    );
                    const responseJson = await response.json();

                    if (responseJson.length > 0) {
                        this.showStatus = true;
                    }

                    this.eTriageEmployeeCountToday = responseJson.length;
                },
                async eTriageCountTodayByClass() {
                    this.isFormLoading = true;

                    const response = await fetch(
                        `${this.apiUrl}etriage/dashboard-etriage-by-class?auth=${this.apiKey}`,
                        {
                            method: "GET",
                            headers: { "Content-Type": "application/json" },
                        }
                    );
                    const responseJson = await response.json();

                    if (responseJson.length > 0) {
                        this.showStatus = true;
                    }

                    this.eTriageByClassCountToday = responseJson;
                },
                async eTriageCountTodayByGender() {
                    const response = await fetch(
                        `${this.apiUrl}etriage/dashboard-etriage-by-gender?auth=${this.apiKey}`,
                        {
                            method: "GET",
                            headers: { "Content-Type": "application/json" },
                        }
                    );
                    const responseJson = await response.json();

                    if (responseJson.length > 0) {
                        this.showStatus = true;
                    }

                    this.eTriageByGenderCountToday = responseJson;
                },
            },
        });
    </script>
</body>

</html>